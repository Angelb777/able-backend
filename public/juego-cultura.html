<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Juego de Cultura</title>
  <style>
    body {
      background-color: #111;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    .pregunta {
      font-size: 22px;
      margin: 20px 0;
    }
    .opcion {
      background-color: #2ecc71;
      color: black;
      border: none;
      padding: 12px;
      margin: 8px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 8px;
      width: 80%;
    }
    .timer {
      color: #e74c3c;
      font-size: 20px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <h1>Juego de Cultura</h1>
  <div id="nivel"></div>
  <div id="timer" class="timer"></div>
  <div id="pregunta" class="pregunta"></div>
  <div id="opciones"></div>
  <div id="estado"></div>

  <script>
    const userId = new URLSearchParams(window.location.search).get("userId");
    if (!userId) {
      alert("‚ùå No se proporcion√≥ el ID del usuario");
      window.close();
    }

    const preguntas = [
  // Nivel 1
  { nivel: 1, pregunta: "¬øCu√°l es la capital de Francia?", opciones: ["A) Berl√≠n", "B) Madrid", "C) Par√≠s"], correcta: "C) Par√≠s" },
  { nivel: 1, pregunta: "¬øQui√©n es el autor de 'Don Quijote'?", opciones: ["A) Cervantes", "B) Shakespeare", "C) Homero"], correcta: "A) Cervantes" },
  { nivel: 1, pregunta: "¬øEn qu√© continente est√° Egipto?", opciones: ["A) Asia", "B) Europa", "C) √Åfrica"], correcta: "C) √Åfrica" },
  { nivel: 1, pregunta: "¬øCu√°l es el oc√©ano m√°s grande del mundo?", opciones: ["A) Atl√°ntico", "B) √çndico", "C) Pac√≠fico"], correcta: "C) Pac√≠fico" },
  { nivel: 1, pregunta: "¬øQu√© planeta es conocido como el Planeta Rojo?", opciones: ["A) Marte", "B) J√∫piter", "C) Venus"], correcta: "A) Marte" },

  // Nivel 2
  { nivel: 2, pregunta: "¬øCu√°l es la moneda oficial de Jap√≥n?", opciones: ["A) Yuan", "B) Yen", "C) Won"], correcta: "B) Yen" },
  { nivel: 2, pregunta: "¬øQu√© instrumento mide la presi√≥n atmosf√©rica?", opciones: ["A) Bar√≥metro", "B) Term√≥metro", "C) Higr√≥metro"], correcta: "A) Bar√≥metro" },
  { nivel: 2, pregunta: "¬øCu√°l es la capital de Italia?", opciones: ["A) Roma", "B) Mil√°n", "C) Venecia"], correcta: "A) Roma" },
  { nivel: 2, pregunta: "¬øQu√© animal es conocido como el rey de la selva?", opciones: ["A) Tigre", "B) Elefante", "C) Le√≥n"], correcta: "C) Le√≥n" },
  { nivel: 2, pregunta: "¬øQui√©n escribi√≥ 'Cien a√±os de soledad'?", opciones: ["A) Gabriel Garc√≠a M√°rquez", "B) Julio Cort√°zar", "C) Jorge Luis Borges"], correcta: "A) Gabriel Garc√≠a M√°rquez" },

  // Nivel 3
  { nivel: 3, pregunta: "¬øCu√°l es la capital de Australia?", opciones: ["A) S√≠dney", "B) Canberra", "C) Melbourne"], correcta: "B) Canberra" },
  { nivel: 3, pregunta: "¬øCu√°l es el r√≠o m√°s largo del mundo?", opciones: ["A) Amazonas", "B) Nilo", "C) Yangts√©"], correcta: "A) Amazonas" },
  { nivel: 3, pregunta: "¬øQui√©n propuso la teor√≠a de la relatividad?", opciones: ["A) Newton", "B) Einstein", "C) Galileo"], correcta: "B) Einstein" },
  { nivel: 3, pregunta: "¬øD√≥nde est√° el desierto del Sahara?", opciones: ["A) Am√©rica", "B) Australia", "C) √Åfrica"], correcta: "C) √Åfrica" },
  { nivel: 3, pregunta: "¬øQu√© elemento tiene el s√≠mbolo 'Na'?", opciones: ["A) Nitr√≥geno", "B) Sodio", "C) Ne√≥n"], correcta: "B) Sodio" },

  // Nivel 4
  { nivel: 4, pregunta: "¬øCu√°l es la unidad b√°sica de la vida?", opciones: ["A) Tejido", "B) C√©lula", "C) √ìrgano"], correcta: "B) C√©lula" },
  { nivel: 4, pregunta: "¬øQu√© pa√≠s es conocido por los canguros?", opciones: ["A) Nueva Zelanda", "B) Australia", "C) Sud√°frica"], correcta: "B) Australia" },
  { nivel: 4, pregunta: "¬øQui√©n formul√≥ las tres leyes del movimiento?", opciones: ["A) Galileo", "B) Newton", "C) Einstein"], correcta: "B) Newton" },
  { nivel: 4, pregunta: "¬øD√≥nde se encuentra Marruecos?", opciones: ["A) Asia", "B) Europa", "C) √Åfrica"], correcta: "C) √Åfrica" },
  { nivel: 4, pregunta: "¬øD√≥nde est√° la lengua?", opciones: ["A) Est√≥mago", "B) Boca", "C) Nariz"], correcta: "B) Boca" },

  // Nivel 5
  { nivel: 5, pregunta: "¬øPrimera mujer en el espacio?", opciones: ["A) Tereshkova", "B) Jemison", "C) Ride"], correcta: "A) Tereshkova" },
  { nivel: 5, pregunta: "¬øQui√©n descubri√≥ la penicilina?", opciones: ["A) Pasteur", "B) Fleming", "C) Curie"], correcta: "B) Fleming" },
  { nivel: 5, pregunta: "¬øGas que causa el cambio clim√°tico?", opciones: ["A) Helio", "B) Ox√≠geno", "C) CO2"], correcta: "C) CO2" },
  { nivel: 5, pregunta: "¬øCient√≠fico del ADN?", opciones: ["A) Watson y Crick", "B) Mendel", "C) Lamarck"], correcta: "A) Watson y Crick" },
  { nivel: 5, pregunta: "¬øOc√©ano m√°s peque√±o?", opciones: ["A) √Årtico", "B) Atl√°ntico", "C) √çndico"], correcta: "A) √Årtico" },

  // Nivel 6
  { nivel: 6, pregunta: "¬øAnimal m√°s grande?", opciones: ["A) Elefante", "B) Ballena azul", "C) Jirafa"], correcta: "B) Ballena azul" },
  { nivel: 6, pregunta: "¬øQu√© forma el 90% del Sol?", opciones: ["A) Helio", "B) Hidr√≥geno", "C) Ox√≠geno"], correcta: "B) Hidr√≥geno" },
  { nivel: 6, pregunta: "¬øCu√°ntos planetas hay?", opciones: ["A) 8", "B) 9", "C) 7"], correcta: "A) 8" },
  { nivel: 6, pregunta: "¬øOc√©ano que rodea Australia?", opciones: ["A) Atl√°ntico", "B) √çndico", "C) Pac√≠fico"], correcta: "C) Pac√≠fico" },
  { nivel: 6, pregunta: "¬øFuerza de ca√≠da libre?", opciones: ["A) Magnetismo", "B) Gravedad", "C) Fricci√≥n"], correcta: "B) Gravedad" },

  // Nivel 7
  { nivel: 7, pregunta: "¬øCapital de Canad√°?", opciones: ["A) Toronto", "B) Vancouver", "C) Ottawa"], correcta: "C) Ottawa" },
  { nivel: 7, pregunta: "¬øContinente con m√°s pa√≠ses?", opciones: ["A) √Åfrica", "B) Asia", "C) Europa"], correcta: "A) √Åfrica" },
  { nivel: 7, pregunta: "¬øS√≠mbolo del oro?", opciones: ["A) Ag", "B) Au", "C) Pb"], correcta: "B) Au" },
  { nivel: 7, pregunta: "¬øDominio de partido √∫nico?", opciones: ["A) Democracia", "B) Totalitarismo", "C) Monarqu√≠a"], correcta: "B) Totalitarismo" },
  { nivel: 7, pregunta: "¬øParte del ojo para ver color?", opciones: ["A) Retina", "B) C√≥rnea", "C) Iris"], correcta: "A) Retina" },

  // Nivel 8
  { nivel: 8, pregunta: "¬øAutor de Hamlet?", opciones: ["A) Dickens", "B) Shakespeare", "C) Twain"], correcta: "B) Shakespeare" },
  { nivel: 8, pregunta: "¬øPico m√°s alto?", opciones: ["A) Everest", "B) K2", "C) Kilimanjaro"], correcta: "A) Everest" },
  { nivel: 8, pregunta: "¬øObra famosa del Louvre?", opciones: ["A) Noche estrellada", "B) √öltima cena", "C) Mona Lisa"], correcta: "C) Mona Lisa" },
  { nivel: 8, pregunta: "¬øQu√© invent√≥ Edison?", opciones: ["A) Bombilla", "B) Radio", "C) Tel√©fono"], correcta: "A) Bombilla" },
  { nivel: 8, pregunta: "¬øQu√© es el Wi-Fi?", opciones: ["A) Carne", "B) Conexi√≥n inal√°mbrica", "C) Navegador"], correcta: "B) Conexi√≥n inal√°mbrica" },

  // Nivel 9
  { nivel: 9, pregunta: "¬øPlaneta con grandes tormentas?", opciones: ["A) Neptuno", "B) J√∫piter", "C) Saturno"], correcta: "B) J√∫piter" },
  { nivel: 9, pregunta: "¬øPadre de la electricidad?", opciones: ["A) Franklin", "B) Tesla", "C) Edison"], correcta: "B) Tesla" },
  { nivel: 9, pregunta: "¬øD√≥nde est√° el Coliseo?", opciones: ["A) Roma", "B) Atenas", "C) Estambul"], correcta: "A) Roma" },
  { nivel: 9, pregunta: "¬øQu√© causa el SIDA?", opciones: ["A) C√°ncer", "B) VIH", "C) Diabetes"], correcta: "B) VIH" },
  { nivel: 9, pregunta: "¬øCapa de la Tierra de rocas?", opciones: ["A) N√∫cleo", "B) Corteza", "C) Manto"], correcta: "B) Corteza" },

  // Nivel 10
  { nivel: 10, pregunta: "¬øTeor√≠a de la evoluci√≥n?", opciones: ["A) Darwin", "B) Newton", "C) Einstein"], correcta: "A) Darwin" },
  { nivel: 10, pregunta: "¬øPa√≠s m√°s poblado?", opciones: ["A) India", "B) China", "C) EEUU"], correcta: "B) China" },
  { nivel: 10, pregunta: "¬øQu√© es un agujero negro?", opciones: ["A) Fen√≥meno espacial", "B) Estrella", "C) Galaxia"], correcta: "A) Fen√≥meno espacial" },
  { nivel: 10, pregunta: "¬øCu√°nto dura un a√±o?", opciones: ["A) 365 d√≠as", "B) 400 d√≠as", "C) 320 d√≠as"], correcta: "A) 365 d√≠as" },
  { nivel: 10, pregunta: "¬øSonido de un perro?", opciones: ["A) Miau", "B) Guau", "C) P√≠o"], correcta: "B) Guau" }
];

preguntas.sort(() => Math.random() - 0.5); // Mezclar preguntas


    let nivelActual = 1;
    let timer;
    let tiempo = 15;

    function obtenerPreguntaAleatoria(nivel) {
      const filtradas = preguntas.filter(p => p.nivel === nivel);
      return filtradas[Math.floor(Math.random() * filtradas.length)];
    }

    function mostrarPregunta() {
      if (nivelActual > 10) {
        alert("üéâ Has completado el juego!");
        window.close();
        return;
      }

      const pregunta = obtenerPreguntaAleatoria(nivelActual);

      document.getElementById("nivel").textContent = `Nivel ${nivelActual} de 10`;
      document.getElementById("pregunta").textContent = pregunta.pregunta;
      document.getElementById("opciones").innerHTML = "";
      document.getElementById("estado").textContent = "";

      tiempo = 15;
      document.getElementById("timer").textContent = `‚è±Ô∏è Tiempo: ${tiempo}s`;
      clearInterval(timer);
      timer = setInterval(() => {
        tiempo--;
        document.getElementById("timer").textContent = `‚è±Ô∏è Tiempo: ${tiempo}s`;
        if (tiempo <= 0) {
          clearInterval(timer);
          alert("‚ùå Tiempo agotado");
          window.close();
        }
      }, 1000);

      pregunta.opciones.forEach(op => {
        const btn = document.createElement("button");
        btn.className = "opcion";
        btn.textContent = op;
        btn.onclick = () => verificarRespuesta(op, pregunta.correcta);
        document.getElementById("opciones").appendChild(btn);
      });
    }

    async function verificarRespuesta(seleccionada, correcta) {
      clearInterval(timer);
      if (seleccionada === correcta) {
        document.getElementById("estado").textContent = "‚úÖ ¬°Correcto! +100 Stepcoins";
        try {
          const res = await fetch("/api/stepcoins/adjust", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              userId,
              cantidad: 100,
              tipo: "cultura",
              descripcion: `Pregunta acertada en nivel ${nivelActual}`
            })
          });
          if (!res.ok) {
            const data = await res.json();
            console.error("‚ùå Error al sumar Stepcoins:", data);
          }
        } catch (err) {
          console.error("‚ùå Error de red:", err);
        }
        setTimeout(() => {
          nivelActual++;
          mostrarPregunta();
        }, 1000);
      } else {
        alert(`‚ùå Incorrecto. La respuesta correcta era: ${correcta}`);
        window.close();
      }
    }

    mostrarPregunta();
  </script>
</body>
</html>
